# 📘 AI日記リフレクションBot（MVP）

## 🎯 目的・コンセプト

ユーザーが LINE 上で日記を書くだけで、AI が感情や主題、傾向を分析・要約し、
自己理解・自己受容・内省習慣の定着をサポートする AI 日記 Bot。

---

## 🚀 プロジェクトのセットアップと起動

### 前提条件

- Node.js (v18以上)
- pnpm
- Cloudflareアカウント

### 初期化

1. **依存関係のインストール**
   ```bash
   pnpm install
   ```

### 環境設定

プロジェクト直下に `.dev.vars` ファイルを追加する

### 開発サーバーの起動

```bash
# 開発モードで起動
pnpm run dev

# または
pnpm start
```

### デプロイ

```bash
pnpm run deploy
```

### 利用可能なコマンド

| コマンド              | 説明                            |
| --------------------- | ------------------------------- |
| `pnpm run dev`        | 開発サーバーを起動              |
| `pnpm start`          | 開発サーバーを起動（devと同じ） |
| `pnpm test`           | テストを実行                    |
| `pnpm run deploy`     | Cloudflare Workersにデプロイ    |
| `pnpm run cf-typegen` | Cloudflareの型定義を生成        |
| `pnpm run format`     | Prettierでコードを自動整形      |
| `pnpm run format:check` | コードフォーマットをチェック    |
| `pnpm run db:erd`     | データベースER図を生成（Database Markup Language形式） |
| `pnpm run db:erd:svg` | データベースER図を生成（SVG形式） |
| `pnpm run db:erd:png` | データベースER図を生成（PNG形式） |

### データベースER図の生成

`schema.dbml`ファイルから視覚的なER図を生成できます：

```bash
# SVG形式で生成（推奨：拡大してもキレイ）
pnpm run db:erd:svg

# PNG形式で生成
pnpm run db:erd:png
```

生成されたファイルは`erd/`ディレクトリに保存されます。

### コードフォーマット

Prettierを使用してコードを自動整形します：

```bash
# コードを自動整形
pnpm run format

# フォーマットのチェックのみ（CI/CD用）
pnpm run format:check
```

---

## 🏗️ システム構成と使用技術

[プロジェクト仕様書](./_llm-docs/project.md)を参照してください。

---

## 🤖 AI駆動開発（仕様書駆動開発）について

このプロジェクトは**AI駆動開発プロセス**により構築されました。従来の開発手法とは異なり、包括的な仕様書とルールベースの開発により、高品質で一貫性のあるコードベースを実現しています。

### 📋 開発プロセスの特徴

#### 1. 仕様書ファースト開発
- **事前設計重視**: コーディング前に詳細な仕様書を作成
- **ドキュメント駆動**: 仕様書に基づいてAIが実装を支援
- **継続的更新**: 実装と並行して仕様書を最新状態に維持

#### 2. AI支援による開発効率化
- **コード生成**: 仕様書に基づくスケルトンコード自動生成
- **品質保証**: 実装ルールに沿ったコードレビュー支援
- **一貫性確保**: プロジェクト全体での命名規則・コーディング規約の統一

#### 3. 知識ベース管理
- **技術知識の蓄積**: 設計判断や実装パターンの文書化
- **ベストプラクティスの共有**: チーム内での知見共有促進
- **保守性向上**: 後続開発者への技術移転効率化

### 📁 ドキュメント構成

#### `_llm-docs/` - LLM用技術ドキュメント

プロジェクトの技術仕様を包括的に記述したLLM向けドキュメント群です：

| ファイル | 内容 | 役割 |
|---------|------|------|
| **project.md** | プロジェクト仕様書（メイン） | システム全体の概要・機能・技術スタック |
| **api-specification.md** | APIエンドポイント仕様 | REST API・Webhook仕様の詳細定義 |
| **database-design.md** | データベース設計 | テーブル構造・リレーション・インデックス設計 |
| **ai-analysis-flow.md** | AI分析フロー詳細 | OpenAI連携・分析ロジック・プロンプト設計 |
| **deployment.md** | デプロイメント手順 | Cloudflare Workers・環境設定・CI/CD |
| **directory-structure.md** | ディレクトリ構成 | プロジェクト構造・ファイル配置ルール |

#### `_llm-rules/` - 実装ルール・ガイドライン

開発品質を保証する実装原則を定義：

| ファイル | 内容 | 役割 |
|---------|------|------|
| **implementation.md** | 実装原則ガイドライン | コーディング規約・エラーハンドリング・セキュリティルール |

### 🔄 AI支援開発フロー

```
1. 要件定義
   ↓
2. 仕様書作成・更新（_llm-docs/）
   ↓
3. 実装ルール確認（_llm-rules/）
   ↓
4. AI支援コード生成
   ↓
5. コードレビュー（AIによる品質チェック）
   ↓
6. テスト実行・デプロイ
   ↓
7. ドキュメント更新
```

### 💡 AI駆動開発の利点

#### 開発効率向上
- **高速プロトタイピング**: 仕様書からの迅速な実装
- **ボイラープレート自動生成**: 定型コードの自動化
- **リファクタリング支援**: 既存コードの品質向上

#### 品質保証強化
- **一貫性確保**: プロジェクト全体での統一されたコード品質
- **エラー削減**: 実装ルールに基づく事前チェック
- **セキュリティ向上**: ベストプラクティスの自動適用

#### 保守性向上
- **ドキュメント同期**: コードと仕様書の整合性維持
- **知識移転効率化**: 新規参加者へのオンボーディング短縮
- **技術負債可視化**: 問題箇所の早期発見・対処

### 🎯 このプロセスで実現された機能

- **LINE Messaging API統合**: Webhook処理・メッセージ送受信
- **AI分析システム**: OpenAI GPT-3.5-turboによる日記分析
- **ローディングアニメーション**: ユーザー体験向上
- **包括的エラーハンドリング**: 堅牢性・可用性確保
- **データベース設計**: Cloudflare D1による効率的データ管理
- **バッチ処理最適化**: Scheduled Workersによる定期処理

---
